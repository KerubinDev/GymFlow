{% extends "base.html" %}

{% block title %}Login - GymFlow{% endblock %}

{% block extra_css %}
<style>
    .login-container {
        max-width: 400px;
        margin: 100px auto;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    
    .logo {
        text-align: center;
        margin-bottom: 30px;
    }
    
    .form-group {
        margin-bottom: 20px;
    }
    
    .esqueci-senha {
        text-align: right;
        margin-bottom: 20px;
    }
    
    .btn-entrar {
        width: 100%;
        padding: 12px;
        font-size: 16px;
        font-weight: bold;
    }
</style>
{% endblock %}

{% block content %}
<div class="login-container bg-white">
    <div class="logo">
        <h2>GymFlow</h2>
        <p class="text-muted">Sistema de Gestão de Academia</p>
    </div>
    
    <form id="formLogin">
        <div class="form-group">
            <label for="email">Email</label>
            <input type="email" 
                   class="form-control" 
                   id="email" 
                   name="email"
                   required>
        </div>
        
        <div class="form-group">
            <label for="senha">Senha</label>
            <input type="password" 
                   class="form-control" 
                   id="senha" 
                   name="senha"
                   required>
        </div>
        
        <div class="esqueci-senha">
            <a href="#" id="btnEsqueciSenha">Esqueci minha senha</a>
        </div>
        
        <button type="submit" class="btn btn-primary btn-entrar">
            Entrar
        </button>
    </form>
    
    <!-- Modal Recuperação de Senha -->
    <div class="modal fade" id="modalRecuperarSenha" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Recuperar Senha</h5>
                    <button type="button" 
                            class="btn-close" 
                            data-bs-dismiss="modal">
                    </button>
                </div>
                <div class="modal-body">
                    <form id="formRecuperarSenha">
                        <div class="form-group">
                            <label for="emailRecuperacao">
                                Digite seu email
                            </label>
                            <input type="email" 
                                   class="form-control" 
                                   id="emailRecuperacao" 
                                   required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" 
                            class="btn btn-secondary" 
                            data-bs-dismiss="modal">
                        Cancelar
                    </button>
                    <button type="button" 
                            class="btn btn-primary" 
                            id="btnEnviarRecuperacao">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const formLogin = document.getElementById('formLogin');
        const btnEsqueciSenha = document.getElementById('btnEsqueciSenha');
        const modalRecuperarSenha = new bootstrap.Modal(
            document.getElementById('modalRecuperarSenha')
        );
        const btnEnviarRecuperacao = document.getElementById(
            'btnEnviarRecuperacao'
        );

        formLogin.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const dados = {
                email: document.getElementById('email').value,
                senha: document.getElementById('senha').value
            };

            try {
                const response = await fetch('/login', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });

                const resultado = await response.json();

                if (response.ok) {
                    // Armazena o token e redireciona
                    localStorage.setItem('token', resultado.token);
                    window.location.href = resultado.redirect;
                } else {
                    alert(resultado.erro || 'Erro ao fazer login');
                }
            } catch (erro) {
                console.error('Erro:', erro);
                alert('Erro ao fazer login');
            }
        });

        btnEsqueciSenha.addEventListener('click', function(e) {
            e.preventDefault();
            modalRecuperarSenha.show();
        });

        btnEnviarRecuperacao.addEventListener('click', async function() {
            const email = document.getElementById('emailRecuperacao').value;

            try {
                const response = await fetch('/recuperar-senha', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email })
                });

                const resultado = await response.json();

                if (response.ok) {
                    alert('Email de recuperação enviado com sucesso!');
                    modalRecuperarSenha.hide();
                } else {
                    alert(resultado.erro || 'Erro ao enviar email');
                }
            } catch (erro) {
                console.error('Erro:', erro);
                alert('Erro ao processar solicitação');
            }
        });
    });
</script>
{% endblock %}
