<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Alunos - Sistema Academia</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" 
          rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="card">
            <div class="card-header">
                <h2>Cadastro de Alunos</h2>
            </div>
            <div class="card-body">
                <form id="formCadastroAluno">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nome" class="form-label">Nome Completo</label>
                            <input type="text" 
                                   class="form-control" 
                                   id="nome" 
                                   name="nome" 
                                   required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="telefone" class="form-label">Telefone</label>
                            <input type="tel" 
                                   class="form-control" 
                                   id="telefone" 
                                   name="telefone" 
                                   required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="dataNascimento" class="form-label">
                                Data de Nascimento
                            </label>
                            <input type="date" 
                                   class="form-control" 
                                   id="dataNascimento" 
                                   name="dataNascimento" 
                                   required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="plano" class="form-label">Plano</label>
                            <select class="form-select" id="plano" name="plano" required>
                                <option value="">Selecione um plano</option>
                            </select>
                        </div>
                    </div>

                    <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="button" 
                                class="btn btn-secondary me-md-2" 
                                onclick="window.history.back()">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Salvar
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js">
    </script>
    <script>
        document.addEventListener('DOMContentLoaded', async function() {
            const formCadastro = document.getElementById('formCadastroAluno');
            const selectPlano = document.getElementById('plano');

            // Carrega os planos disponÃ­veis
            try {
                const response = await fetch('/planos', {
                    headers: {
                        'Authorization': 'Bearer ' + localStorage.getItem('token')
                    }
                });
                const planos = await response.json();
                
                planos.forEach(plano => {
                    const option = document.createElement('option');
                    option.value = plano.id;
                    option.textContent = `${plano.nome} - R$ ${plano.valor}`;
                    selectPlano.appendChild(option);
                });
            } catch (erro) {
                console.error('Erro ao carregar planos:', erro);
            }

            formCadastro.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const dados = {
                    nome: document.getElementById('nome').value,
                    telefone: document.getElementById('telefone').value,
                    data_nascimento: document.getElementById('dataNascimento').value,
                    plano_id: document.getElementById('plano').value
                };

                try {
                    const response = await fetch('/alunos', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': 'Bearer ' + localStorage.getItem('token')
                        },
                        body: JSON.stringify(dados)
                    });

                    if (response.ok) {
                        alert('Aluno cadastrado com sucesso!');
                        window.location.href = '/alunos';
                    } else {
                        const erro = await response.json();
                        alert(erro.erro || 'Erro ao cadastrar aluno');
                    }
                } catch (erro) {
                    console.error('Erro:', erro);
                    alert('Erro ao processar cadastro');
                }
            });
        });
    </script>
</body>
</html> 