{% extends "base.html" %}

{% block title %}GymFlow - Dashboard{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<style>
    /* Fundo e efeitos */
    .dashboard-container {
        position: relative;
        z-index: 1;
    }

    .particles-background {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        background: linear-gradient(135deg, #1a1e21 0%, #2c3e50 100%);
    }

    /* Cards com efeito vidro */
    .glass-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 15px;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .glass-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .text-gradient {
        background: linear-gradient(45deg, #4ECDC4, #45B7AF);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: bold;
    }

    .card-title {
        font-size: 1.1rem;
        margin-bottom: 1rem;
    }

    .display-4 {
        font-size: 2.5rem;
        font-weight: 600;
    }

    /* Gráficos */
    .chart-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }

    /* Tabelas */
    .table-container {
        background: rgba(255, 255, 255, 0.05);
        border-radius: 15px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .custom-table {
        color: #fff;
    }

    .custom-table th {
        border-color: rgba(255, 255, 255, 0.1);
        font-weight: 600;
    }

    .custom-table td {
        border-color: rgba(255, 255, 255, 0.1);
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid mt-4 dashboard-container">
    <!-- Fundo animado com partículas -->
    <div id="particles-js" class="particles-background"></div>

    <!-- Métricas -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card glass-card h-100">
                <div class="card-body">
                    <h5 class="card-title text-gradient">
                        <i class="fas fa-users mr-2"></i>Total de Alunos
                    </h5>
                    <h2 class="display-4 mb-0 text-white">{{ metricas.total_alunos }}</h2>
                    <p class="text-muted">Ativos no momento</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card glass-card h-100">
                <div class="card-body">
                    <h5 class="card-title text-gradient">
                        <i class="fas fa-dollar-sign mr-2"></i>Receita Mensal
                    </h5>
                    <h2 class="display-4 mb-0 text-white">R$ {{ "%.2f"|format(metricas.receita_mensal) }}</h2>
                    <p class="text-muted">Mês atual</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card glass-card h-100">
                <div class="card-body">
                    <h5 class="card-title text-gradient">
                        <i class="fas fa-chart-line mr-2"></i>Novas Matrículas
                    </h5>
                    <h2 class="display-4 mb-0 text-white">{{ metricas.novas_matriculas }}</h2>
                    <p class="text-muted">Últimos 30 dias</p>
                </div>
            </div>
        </div>

        <div class="col-md-3">
            <div class="card glass-card h-100">
                <div class="card-body">
                    <h5 class="card-title text-gradient">
                        <i class="fas fa-check-circle mr-2"></i>Presença Diária
                    </h5>
                    <h2 class="display-4 mb-0 text-white">{{ metricas.presenca_diaria }}</h2>
                    <p class="text-muted">Hoje</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Gráficos -->
    <div class="row mb-4">
        <div class="col-md-8">
            <div class="chart-container">
                <h5 class="text-gradient mb-4">Receita Mensal</h5>
                <canvas id="receitaChart"></canvas>
            </div>
        </div>
        <div class="col-md-4">
            <div class="chart-container">
                <h5 class="text-gradient mb-4">Distribuição por Plano</h5>
                <canvas id="planosChart"></canvas>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="chart-container">
                <h5 class="text-gradient mb-4">Presença por Horário</h5>
                <canvas id="presencaChart"></canvas>
            </div>
        </div>
        <div class="col-md-6">
            <div class="chart-container">
                <h5 class="text-gradient mb-4">Matrículas vs Cancelamentos</h5>
                <canvas id="matriculasChart"></canvas>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
<script>
    // Configuração do particles.js
    particlesJS('particles-js', {
        particles: {
            number: {
                value: 80,
                density: {
                    enable: true,
                    value_area: 800
                }
            },
            color: {
                value: '#4ECDC4'
            },
            shape: {
                type: 'circle'
            },
            opacity: {
                value: 0.5,
                random: false
            },
            size: {
                value: 3,
                random: true
            },
            line_linked: {
                enable: true,
                distance: 150,
                color: '#4ECDC4',
                opacity: 0.4,
                width: 1
            },
            move: {
                enable: true,
                speed: 2,
                direction: 'none',
                random: false,
                straight: false,
                out_mode: 'out',
                bounce: false
            }
        },
        interactivity: {
            detect_on: 'canvas',
            events: {
                onhover: {
                    enable: true,
                    mode: 'repulse'
                },
                resize: true
            }
        },
        retina_detect: true
    });

    // Configuração dos gráficos
    const formatarMoeda = (valor) => {
        return new Intl.NumberFormat('pt-BR', {
            style: 'currency',
            currency: 'BRL'
        }).format(valor);
    };

    // Gráfico de Receita Mensal
    const ctxReceita = document.getElementById('receitaChart').getContext('2d');
    new Chart(ctxReceita, {
        type: 'line',
        data: {
            labels: {{ metricas.labels_meses|tojson }},
            datasets: [{
                label: 'Receita Mensal',
                data: {{ metricas.valores_mensais|tojson }},
                borderColor: '#4ECDC4',
                backgroundColor: 'rgba(78, 205, 196, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: (value) => formatarMoeda(value)
                    }
                }
            }
        }
    });

    // Outros gráficos seguem o mesmo padrão...
</script>
{% endblock %} 